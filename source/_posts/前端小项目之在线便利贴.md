---
title: å‰ç«¯å°é¡¹ç›®ä¹‹åœ¨çº¿ä¾¿åˆ©è´´
date: 2017-09-13 20:48:33
tags: [node, js]
categories: å‰ç«¯
copyright: true
keywords: express
---

----

## å®ç°çš„æ•ˆæœå¦‚ä¸‹ï¼š

![](https://ws3.sinaimg.cn/large/006tKfTcly1fjhulxqhxuj31kw0j976o.jpg)

ç•Œé¢å¯èƒ½ä¸æ˜¯å¤ªå¥½çœ‹ğŸ˜ï¼Œè€ƒè™‘åˆ°å®¹å™¨çš„é«˜åº¦ä¼šè¢«æ‹‰é•¿ï¼Œå› æ­¤æ²¡æœ‰ç”¨å›¾ç‰‡åšèƒŒæ™¯ã€‚

## é¢„è§ˆ
[ä¾¿åˆ©è´´](http://note.shenzekun.cn)

<!--more-->

## æ¶‰åŠçš„çŸ¥è¯†ç‚¹

* `sass`(css é¢„ç¼–è¯‘å™¨)
* `webpack`ï¼ˆè‡ªåŠ¨åŒ–æ„å»ºå·¥å…·ï¼Œå®ç°LESS,CSS,JSç¼–è¯‘å’Œå‹ç¼©ä»£ç ï¼‰
* `express` (åŸºäº Node.js å¹³å°çš„ web å¼€å‘æ¡†æ¶)
* `html+css`
* `Node.js`(åŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒ)
* `jQuery`(ä¸€ä¸ªå¿«é€Ÿã€ç®€æ´çš„JavaScriptæ¡†æ¶)
* `sequelize`(Nodeçš„ORMæ¡†æ¶Sequelizeæ“ä½œæ•°æ®åº“)
* `passport`(å®ç°ç¬¬ä¸‰æ–¹ç™»å½•)


## å®ç°åŠŸèƒ½
* githubç¬¬ä¸‰æ–¹ç™»å½•
* æ·»åŠ ç¬”è®°ï¼ˆç™»å½•æˆåŠŸåï¼‰
* åˆ é™¤ç¬”è®°
* ä¿®æ”¹ç¬”è®°
* ä½¿ç”¨ markdown(ç±»ä¼¼ typroa)
* ç¬”è®°æ‹–æ‹½

## å‡†å¤‡å·¥ä½œ

* **å¿…è¦æ¡ä»¶**ï¼šå·²ç»å®‰è£…å¥½äº†nodeç¯å¢ƒ,è¿˜æ²¡å®‰è£…çš„å¯ä»¥å»[node](http://nodejs.cn/download/)ä¸­æ–‡å®˜ç½‘ä¸‹è½½
* **å°æç¤º**ï¼šå¦‚æœç”¨ npm ä¸‹è½½æ„Ÿè§‰æ…¢çš„è¯ï¼Œå¯ä»¥ä¸‹è½½ä¸€ä¸ªåˆ‡æ¢é•œåƒæºçš„å·¥å…·`nrm`,åœ¨ç»ˆç«¯è¾“å…¥ï¼š

```
npm i nrm -g
```
ç„¶åå¦‚ä¸‹æ“ä½œï¼š
    
![](https://ws1.sinaimg.cn/large/006tKfTcly1fjhuypg0s6j31co0v6439.jpg)
    
   **å¼€å§‹ï¼ï¼**

1.**æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œåå­—è‡ªå·±èµ·ï¼Œæ‰“å¼€ç»ˆç«¯ï¼Œåˆ‡æ¢åˆ°è‡ªå·±æ–°å»ºæ–‡ä»¶å¤¹ï¼Œå¦‚**ï¼š

```
cd (æ–‡ä»¶å¤¹åç§°)
```
    
2.**ç”Ÿæˆ `package.json`**


```
npm init -y
```
    
3.**å®‰è£… express**


```
npm i express --save
```
    
4.**å®‰è£… [expressç”Ÿæˆå™¨](http://www.expressjs.com.cn/starter/generator.html):**

```
npm install express-generator --save
```
    
5.**ç”Ÿæˆ ejs æ¨¡æ¿ï¼ˆç±»ä¼¼ jsp çš„å†™æ³•ï¼‰**

```
express -f -e
npm i
```
    
![](https://ws3.sinaimg.cn/large/006tKfTcly1fjhv8g9apcj30au0cqq30.jpg)
    
    
    
    
å…¶ä¸­`public`ç”¨æ¥å­˜æ”¾ç¼–è¯‘åçš„jsæ–‡ä»¶ä»¥åŠç¼–è¯‘å¥½çš„cssæ–‡ä»¶ç­‰ï¼Œ`routes`ç”¨æ¥å­˜æ”¾å¤„ç† ajax çš„è¯·æ±‚æ–‡ä»¶ï¼Œviewså°±æ˜¯å­˜æ”¾è§†å›¾æ–‡ä»¶
ç„¶åæ–°å»º database å’Œ srcï¼š

![](https://ws1.sinaimg.cn/large/006tKfTcly1fji1acleqhj30ba0k0mxg.jpg)

å…¶ä¸­ src/js é‡Œé¢ app ä»£è¡¨ä¸åŒé¡µé¢çš„å…¥å£æ–‡ä»¶ï¼Œlib å°±æ˜¯ä¸€äº›å¸¸ç”¨çš„åº“ï¼Œmod å°±æ˜¯ä½ å†™çš„ä¸€äº›æ¨¡å—ï¼Œdatabase ç”¨æ¥å­˜æ”¾æ•°æ®åº“æ•°æ®çš„

6.**è¾“å…¥ï¼š**

```
npm start
```
    
å¦‚æœæœ‰å‡ºç°ä¸‹é¢çš„é”™è¯¯ï¼š

![](https://ws3.sinaimg.cn/large/006tKfTcly1fjhvfxr6p3j319i0qq42h.jpg)

å‡ºç°è¿™ä¸ªé”™è¯¯æ˜¯å› ä¸ºä½ æ²¡æœ‰ä¸‹è½½æ¨¡å—ï¼Œåªéœ€åœ¨ç»ˆç«¯è¾“å…¥ï¼š

```
npm i (æ¨¡å—å) --save
```

å°±å¯ä»¥äº†    

7.**æ‰“å¼€æµè§ˆå™¨ï¼Œè¾“å…¥`localhost:3000`**
å‡ºç°ä¸‹é¢è¿™æ ·å°±è¯´æ˜æˆåŠŸäº†ï¼š

![](https://ws2.sinaimg.cn/large/006tKfTcly1fjhvj4lwtgj316a0cgjrb.jpg)
    
8.**æ¥ä¸‹æ¥å®‰è£…webpackå’Œç›¸å…³ä¾èµ–**

```
npm i webpack --save-dev
npm i --save css-loader style-loader express-session express-flash node-sass passport sass sass-loader sequelize sqlite3 extract-text-webpack-plugin onchange
```
    
9.**åœ¨ src é‡Œå»ºä¸€ä¸ª webpack.config.jsï¼Œé…ç½®å¦‚ä¸‹**ï¼š

```
var webpack = require('webpack');
var path = require('path');
var ExtractTextPlugin = require('extract-text-webpack-plugin')
var autoprefixer = require('autoprefixer');
    
module.exports = {
    entry: path.join(__dirname, "js/app/index"),
    output: {
        path: path.join(__dirname, "../public"),
        filename: "js/index.js"
    },
    module: {
        rules: [{
            test: /(\.scss)$/,
            use: ExtractTextPlugin.extract({
                fallback: "style-loader",
                use: ["css-loader", "sass-loader"]
            }) //æŠŠ css æŠ½ç¦»å‡ºæ¥ç”Ÿæˆä¸€ä¸ªæ–‡ä»¶
        }]
    },
    resolve: {
        alias: {
            jquery: path.join(__dirname, "js/lib/jquery-2.0.3.min.js"),
            mod: path.join(__dirname, "js/mod"),
            sass: path.join(__dirname, "sass")
        }
    },
    plugins: [
        new webpack.ProvidePlugin({
            $: "jquery"
        }),
        new ExtractTextPlugin("css/index.css"),
        new webpack.LoaderOptionsPlugin({
            options: {
                css: [
                    autoprefixer(),
                ]
            }
        }),
        new webpack.optimize.UglifyJsPlugin({
            compress: {
                warnings: false
            }
        })
    ]
}
```
    
    
 
    
è¯´æ˜

 * entry:å…¥å£æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯ src/js/appé‡Œé¢çš„index.js,å…¶ä¸­__dirnameæ˜¯è·å¾—å½“å‰æ–‡ä»¶æ‰€åœ¨ç›®å½•çš„å®Œæ•´ç›®å½•å
 * output:è¾“å‡ºç¼–è¯‘åçš„æ–‡ä»¶ index.jsï¼Œè¾“å‡ºåˆ° public/js é‡Œé¢
 * moduleï¼šé…ç½®Loadersï¼Œé€šè¿‡ä½¿ç”¨ä¸åŒçš„loaderï¼Œwebpackæœ‰èƒ½åŠ›è°ƒç”¨å¤–éƒ¨çš„è„šæœ¬æˆ–å·¥å…·ï¼Œå®ç°å¯¹ä¸åŒæ ¼å¼çš„æ–‡ä»¶çš„å¤„ç†ï¼Œæ¯”å¦‚è¯´åˆ†æè½¬æ¢scssä¸ºcssï¼Œæˆ–è€…æŠŠä¸‹ä¸€ä»£çš„JSæ–‡ä»¶
 * resolve.aliasï¼šè®¾ç½®æ¨¡å—åˆ«åï¼Œä¾¿äºæˆ‘ä»¬æ›´æ–¹ä¾¿å¼•ç”¨ï¼Œæ¯”å¦‚è¯´æˆ‘åœ¨ jsé‡Œé¢çš„æ–‡ä»¶éœ€è¦ jqueryï¼Œåœ¨é‡Œé¢çš„æ–‡ä»¶ç›´æ¥å†™ require("jquery") å°±è¡Œäº†
 * å¦‚æœæ‰€æœ‰æ–‡ä»¶éƒ½éœ€è¦ jquery,é‚£ä¹ˆç›´æ¥åœ¨ pluginsé‡Œé¢å†™æˆè¿™æ ·ï¼š
 
    ![](https://ws1.sinaimg.cn/large/006tKfTcly1fji3f1ap39j30ik03cglh.jpg)
    
    å°±ä¸éœ€è¦ require äº†
    
     ![](https://ws3.sinaimg.cn/large/006tKfTcly1fji3x6gw2oj30i005q748.jpg)
     è¿™ä¸ªæ˜¯å‹ç¼©æ–‡ä»¶çš„
    
    
    
10.**åœ¨ package.json ä¸­ï¼Œå¢åŠ å¦‚ä¸‹ä¸¤æ¡ï¼š**
![](https://ws2.sinaimg.cn/large/006tKfTcly1fji3q8xe7tj310i068js2.jpg)

å†™æˆè¿™æ ·ï¼Œä½ åœ¨ç»ˆç«¯å°±å¯ä»¥å†™æˆ`npm run webpack` æ¥ç¼–è¯‘æ–‡ä»¶ï¼Œ
`npm run watch`æ¥ç›‘æ§ src é‡Œé¢çš„ js å’Œ scss çš„å˜åŒ–ï¼Œåªè¦ä¸€ä¿®æ”¹ï¼Œè¿›è¡Œç¼–è¯‘ï¼Œæé«˜äº†æ•ˆç‡



11.**æµ‹è¯•**

ä½ å¯ä»¥è¯•è¯•åœ¨ js é‡Œé¢çš„ index.jså†™ç‚¹ä¸œè¥¿ï¼Œç„¶å npm run webpackï¼Œå¦‚æœç»ˆç«¯æ˜¾ç¤ºæ˜¯è¿™æ ·ï¼š

![](https://ws4.sinaimg.cn/large/006tKfTcly1fji43t9rgej31b20ug0y0.jpg)

å°±è¯æ˜æˆåŠŸäº†
    
    


## é¡¹ç›®æ€è·¯

é€»è¾‘æ¯”è¾ƒç®€å•

1. é¦–å…ˆç”¨æˆ·å¿…é¡»ç™»å½•æ‰èƒ½æ·»åŠ ç¬”è®°ï¼Œå½“ç”¨æˆ·å¤±ç„¦çš„æ—¶å€™ï¼Œå°†æ•°æ®æ’å…¥æ•°æ®åº“ï¼Œå¹¶ä¸”é‡æ–°å¸ƒå±€ï¼ˆç€‘å¸ƒæµï¼‰
2. ç”¨æˆ·ä¸èƒ½æ›´æ”¹å…¶ä»–ç”¨æˆ·çš„ç¬”è®°ï¼Œé™¤äº†ç®¡ç†å‘˜ğŸ˜„
3. ç”¨æˆ·æ›´æ–°ç¬”è®°ä¹‹åï¼Œæ•°æ®åº“çš„æ•°æ®é‡æ–°æ›´æ–°ï¼Œé‡æ–°å¸ƒå±€
4. ç”¨æˆ·å¯ä»¥åˆ é™¤ç¬”è®°ï¼Œæ•°æ®ä»æ•°æ®åº“ä¸­åˆ é™¤ï¼Œé‡æ–°å¸ƒå±€
5. ç”¨æˆ·å¯ä»¥æ‹–æ‹½ç¬”è®°ï¼Œä½†ä¸å°†ä½ç½®å­˜å…¥æ•°æ®åº“


## å®ç°
html,csså°±ä¸è®²äº†ï¼Œå¯ä»¥çœ‹çœ‹æˆ‘çš„[æºç ](https://github.com/shenzekun/sticky-note),ä¸»è¦è®² jsã€‚

1.**ç€‘å¸ƒæµçš„å®ç°**

æ€è·¯ï¼šï¼ˆå‰ææ˜¯å¿…é¡»ç»å¯¹å®šä½ï¼‰
>1. è·å–å…ƒç´ çš„å®½åº¦
>2. é€šè¿‡çª—å£çš„å®½åº¦é™¤ä»¥å…ƒç´ çš„å®½åº¦æ¥è·å–åˆ—æ•°
>3. åˆå§‹åŒ–ä¸€ä¸ªæ•°ç»„æ¥è·å–æ¯åˆ—çš„é«˜åº¦ï¼Œåˆå§‹åŒ–æ¯åˆ—çš„é«˜åº¦ä¸º0
>4. éå†å…ƒç´ ï¼Œè·å–æœ€å°çš„çš„åˆ—æ•°çš„é«˜åº¦å’Œç´¢å¼•ï¼Œå¯¹å½“å‰å…ƒç´ è¿›è¡Œå®šä½ï¼Œåˆ—æ•°é«˜åº¦åŠ ç­‰äºå½“å‰å…ƒç´ çš„é«˜åº¦
    
    
    

çŸ¥é“æ€è·¯åï¼Œä»£ç å¾ˆå¿«å°±å†™å‡ºæ¥äº†ï¼š

```
var WaterFall = (function () {
        var $ct, $items;
        function render($c) {
            $ct = $c;
            $items = $ct.children();
            var nodeWidth = $items.outerWidth(true),
                windowHeight = $(window).height(),
                colNum = parseInt($(window).width() / nodeWidth), //è·å–åˆ—æ•°
                colSumHeight = []; //è·å–æ¯åˆ—çš„é«˜åº¦
            //å¯¹æ¯åˆ—çš„é«˜åº¦è¿›è¡Œåˆå§‹åŒ–
            for (var i = 0; i < colNum; i++) {
                colSumHeight[i] = 0;
            }
            $items.each(function () {
                var $current = $(this);
                var index = 0,
                    minSumHeight = colSumHeight[0];
                //è·å–æœ€å°çš„çš„åˆ—æ•°çš„é«˜åº¦å’Œç´¢å¼•
                for (var i = 0; i < colSumHeight.length; i++) {
                    if (minSumHeight > colSumHeight[i]) {
                        index = i;
                        minSumHeight = colSumHeight[i];
                    }
                }            
                //æ”¹å˜çª—å£é«˜åº¦
                if (windowHeight < minSumHeight) {
                    $("body").height(minSumHeight);
                } else {
                    $("body").height(windowHeight - 72);
                }
                //å¯¹å½“å‰å…ƒç´ è¿›è¡Œå®šä½
                $current.animate({
                    left: nodeWidth * index,
                    top: minSumHeight
                }, 5);
                colSumHeight[index] += $current.outerHeight(true);
    
            });
        }
        //å½“çª—å£å‘ç”Ÿå˜åŒ–æ—¶ï¼Œé‡æ–°æ¸²æŸ“
        $(window).on('resize', function () {
            render($ct);
        });
        return {
            init: render
        }
    })();
```
    
2.**ç¬”è®°çš„æ‹–æ‹½**
    
æˆ‘ä»¬å…ˆçœ‹ä¸ªå›¾

![](https://ws1.sinaimg.cn/large/006tKfTcly1fji626ceeuj30r40p8t96.jpg)

å› æ­¤ä»£ç å¦‚ä¸‹ï¼š

```
      //è®¾ç½®ç¬”è®°çš„ç§»åŠ¨
            $noteHead.on('mousedown', function (e) {
                var evtX = e.pageX - $note.offset().left, //evtX è®¡ç®—äº‹ä»¶çš„è§¦å‘ç‚¹åœ¨ dialogå†…éƒ¨åˆ° dialog çš„å·¦è¾¹ç¼˜çš„è·ç¦»
                    evtY = e.pageY - $note.offset().top;
                $note.addClass('draggable').data('evtPos', {
                    x: evtX,
                    y: evtY
                }); //æŠŠäº‹ä»¶åˆ° dialog è¾¹ç¼˜çš„è·ç¦»ä¿å­˜ä¸‹æ¥
            }).on('mouseup', function () {
                $note.removeClass('draggable').removeData('pos');
            });
    
            $('body').on('mousemove', function (e) {
                $('.draggable').length && $('.draggable').offset({
                    top: e.pageY - $('.draggable').data('evtPos').y, // å½“ç”¨æˆ·é¼ æ ‡ç§»åŠ¨æ—¶ï¼Œæ ¹æ®é¼ æ ‡çš„ä½ç½®å’Œå‰é¢ä¿å­˜çš„è·ç¦»ï¼Œè®¡ç®— dialog çš„ç»å¯¹ä½ç½®
                    left: e.pageX - $('.draggable').data('evtPos').x
                });
            });
        },
```

3.**æç¤ºæ¨¡å—**

è¿™ä¸ªæ¯”è¾ƒå®¹æ˜“ï¼š
    
```
    /* 
    æç¤ºæ¨¡å—
    å‚æ•°ï¼šçŠ¶æ€(1è¡¨ç¤ºæˆåŠŸï¼Œ0è¡¨ç¤ºå¤±è´¥)ï¼Œæ¶ˆæ¯ï¼Œå‡ºç°æ—¶é—´(ä¸å†™é»˜è®¤æ˜¯1s)
     */
    function toast(status, msg, time) {
        this.status = status;
        this.msg = msg;
        this.time = time || 1000;
        this.createToast();
        this.showToast();
    }
    
    toast.prototype = {
        createToast: function () {
            if (this.status === 1) {
                var html = '<div class="toast"><img src="../../imgs/1.png" class="toast_icon"></img><span class="toast_word">' + this.msg + '</span></div>';
                this.$toast = $(html);
                $('body').append(this.$toast);
            } else {
                var html = '<div class="toast"><img src="../../imgs/0.png" class="toast_icon"></img><span class="toast_word">' + this.msg + '</span></div>';
                this.$toast = $(html);
                $('body').append(this.$toast);
            }
        },
        showToast: function () {
            var _this = this;
            this.$toast.fadeIn(300, function () {
                setTimeout(function () {
                    _this.$toast.fadeOut(300, function () {
                        _this.$toast.remove();
                    });
                }, _this.time);
            })
        }
    }
    
    function Toast(status, msg, time) {
        return new toast(status, msg, time);
    }
```

4.**ç¬”è®°æ¨¡å—**

æ€è·¯ï¼š
>1. åˆå§‹åŒ–ï¼ˆå¦‚ idï¼Œusername ç­‰ç­‰ï¼‰
>2. åˆ›å»ºèŠ‚ç‚¹
>3. è®¾ç½®é¢œè‰²
>4. ç»‘å®šäº‹ä»¶

    

```
function Note(opts) {
    this.initOpts(opts);
    this.createNode();
    this.setColor();
    this.bind();
}

Note.prototype = {
    colors: [
        ['#ea9b35', '#efb04e'], // headColor, containerColor
        ['#dd598b', '#e672a2'],
        ['#c24226', '#d15a39'],
        ['#c1c341', '#d0d25c'],
        ['#3f78c3', '#5591d2']
    ],
    defaultOpts: {
        id: '', //Noteçš„ id
        $ct: $('#content').length > 0 ? $('#content') : $('body'), //é»˜è®¤å­˜æ”¾ Note çš„å®¹å™¨
        context: 'è¯·è¾“å…¥å†…å®¹', //Note çš„å†…å®¹
        createTime: new Date().toLocaleDateString().replace(/\//g, '-').match(/^\d{4}-\d{1,2}-\d{1,2}/),
        username: 'admin'
    },
    initOpts: function (opts) {
        this.opts = $.extend({}, this.defaultOpts, opts || {});
        if (this.opts.id) {
            this.id = this.opts.id;
        }
        this.createTime = this.opts.createTime ? this.opts.createTime : new Date().toLocaleDateString().replace(/\//g, '-').match(/^\d{4}-\d{1,2}-\d{1,2}/);
        this.username = this.opts.username ? this.opts.username : 'admin'
    },
    createNode: function () {
        var tpl = '<div class="note">' +
            '<div class="note-head"><span class="delete">&times;</span></div>' +
            '<div class="note-ct" contenteditable="true"></div>' +
            '<div class="note-info"><div class="note-name">' + this.username + '</div><div class="note-time">' + this.createTime + '</div>' +
            '</div>';
        this.$note = $(tpl);
        this.$note.find('.note-ct').html(this.opts.context);
        this.opts.$ct.append(this.$note);
        //if (!this.id) this.$note.css('bottom', '10px'); //æ–°å¢æ”¾åˆ°å³è¾¹
        Event.fire('waterfall');
    },

    setColor: function () {
        var color = this.colors[Math.floor(Math.random() * 5)];
        this.$note.find(".note-head").css('background-color', color[0]);
        this.$note.find('.note-ct').css('background-color', color[1]);
        this.$note.find('.note-info').css('background-color', color[1]);
    },
    setLayout: function () {
        var self = this;
        if (self.clock) {
            clearTimeout(self.clock);
        }
        self.clock = setTimeout(function () {
            Event.fire('waterfall');
        }, 100);
    },
    bind: function () {
        var _this = this, //è®°å½•ä¸‹å‘ï¼Œä¹‹å‰æœ«å°¾æ˜¯åˆ†å·ä¸æ˜¯é€—å·åé¢éƒ½å˜æˆäº†å…¨å±€å˜é‡ç»“æœé€ æˆäº†æœ€åä¸€ä¸ªæ‰èƒ½ä¿®æ”¹ğŸ˜‚
            $note = this.$note,
            $noteHead = $note.find('.note-head'),
            $noteCt = $note.find('.note-ct'),
            $close = $note.find('.delete');

        $close.on('click', function () {
            _this.delete();
        });

        $noteCt.on('focus', function () {
            if ($noteCt.html() === 'è¯·è¾“å…¥å†…å®¹') $noteCt.html('');
            $noteCt.data('before', $noteCt.html());
        }).on('blur paste', function () {
            if ($noteCt.data('before') != $noteCt.html()) {
                $noteCt.data('before', $noteCt.html());
                _this.setLayout();
                if (_this.id) { //åˆ¤æ–­æ˜¯å¦æœ‰è¿™ä¸ªidï¼Œå¦‚æœæœ‰å°±æ›´æ–°ï¼Œå¦‚æœæ²¡æœ‰å°±æ·»åŠ 
                    _this.edit($noteCt.html())
                } else {
                    _this.add($noteCt.html())
                }
            }
        });

        //è®¾ç½®ç¬”è®°çš„ç§»åŠ¨
        $noteHead.on('mousedown', function (e) {
            var evtX = e.pageX - $note.offset().left, //evtX è®¡ç®—äº‹ä»¶çš„è§¦å‘ç‚¹åœ¨ dialogå†…éƒ¨åˆ° dialog çš„å·¦è¾¹ç¼˜çš„è·ç¦»
                evtY = e.pageY - $note.offset().top;
            $note.addClass('draggable').data('evtPos', {
                x: evtX,
                y: evtY
            }); //æŠŠäº‹ä»¶åˆ° dialog è¾¹ç¼˜çš„è·ç¦»ä¿å­˜ä¸‹æ¥
        }).on('mouseup', function () {
            $note.removeClass('draggable').removeData('pos');
        });

        $('body').on('mousemove', function (e) {
            $('.draggable').length && $('.draggable').offset({
                top: e.pageY - $('.draggable').data('evtPos').y, // å½“ç”¨æˆ·é¼ æ ‡ç§»åŠ¨æ—¶ï¼Œæ ¹æ®é¼ æ ‡çš„ä½ç½®å’Œå‰é¢ä¿å­˜çš„è·ç¦»ï¼Œè®¡ç®— dialog çš„ç»å¯¹ä½ç½®
                left: e.pageX - $('.draggable').data('evtPos').x
            });
        });
    },





    /* æ·»åŠ ç¬”è®°åˆ°æ•°æ®åº“ */
    add: function (msg) {
        var _this = this;
        $.post('/api/notes/add', {
            note: msg
        }).done(function (res) {
            if (res.status === 1) {
                _this.id = res.id;
                Toast(1, 'æ·»åŠ æˆåŠŸï¼');
            } else {
                _this.$note.remove();
                Event.fire('waterfall');
                Toast(0, res.errorMsg);
            }
        })
    },
    /* ç¼–è¾‘ç¬”è®°æ•°æ®åº“ */
    edit: function (msg) {
        var _this = this;
        $.post('/api/notes/edit', {
            id: this.id,
            note: msg
        }).done(function (res) {
            if (res.status === 1) {
                Toast(1, 'æ›´æ–°æˆåŠŸï¼');
            } else {
                Toast(0, res.errorMsg);
            }
        });
    },
    /* åˆ é™¤ç¬”è®° */
    delete: function () {
        var _this = this;
        if (confirm("ç¡®è®¤è¦åˆ é™¤å—ï¼Ÿ")) {
            $.post('/api/notes/delete', {
                id: this.id
            }).done(function (res) {
                if (res.status === 1) {
                    Toast(1, 'åˆ é™¤æˆåŠŸï¼');
                    _this.$note.remove();
                    Event.fire('waterfall')
                } else {
                    Toast(0, res.errorMsg);
                }
            });
        }
    }
}


```

5.**ç¬”è®°ç®¡ç†æ¨¡å—**

```
var NoteManager = (function () {
    //é¡µé¢åŠ è½½
    function load() {
        $.get('api/notes').done(function (res) {
            if (res.status === 1) {
                $.each(res.data, function (index, msg) {
                    new Note({
                        id: msg.id,
                        context: msg.text,
                        createTime: msg.createdAt.match(/^\d{4}-\d{1,2}-\d{1,2}/),
                        username: msg.username
                    });
                });

                Event.fire('waterfall');

            } else {
                Toast(0, res.errorMsg);
            }
        }).fail(function () {
            Toast(0, "ç½‘ç»œå¼‚å¸¸");
        });
    }

    /* æ·»åŠ ç¬”è®° */
    function add() {
        $.get('/login').then(function (res) {//åˆ¤æ–­æ˜¯å¦ç™»å½•
            if (res.status === 1) {
                new Note({
                    username: res.username
                });
            } else {
                Toast(0, res.errorMsg);
            }
        });
    }
    return {
        load: load,
        add: add
    }
})();
```

6.**å‘å¸ƒè®¢é˜…æ¨¡å¼**

```
/* å‘å¸ƒè®¢é˜…æ¨¡å¼ */
var Event = (function () {
    var events = {};

    function on(evt, handler) {
        events[evt] = events[evt] || [];
        events[evt].push({
            handler: handler
        });
    }

    function fire(evt, args) {
        if (!events[evt]) {
            return;
        }
        for (var i = 0; i < events[evt].length; i++) {
            events[evt][i].handler(args);
        }
    }

    function off(name) {
        delete events[name];
    }
    return {
        on: on,
        fire: fire,
        off: off
    }
})();
```

å†™å®Œæ¨¡å—åï¼Œå†™å…¥å£æ–‡ä»¶index.js

```
require('sass/index.scss');
var Toast = require('mod/toast.js').Toast;
var WaterFall = require('mod/waterfall.js');
var NoteManager = require('mod/note-manager');
var Event = require('mod/event.js');


NoteManager.load();
$('.add-note').on('click', function () {
    NoteManager.add();
})

Event.on('waterfall', function () {
    WaterFall.init($("#content"));
})
```

åˆ°è¿™å°±å·®ä¸å¤šå®Œæˆäº†70%äº†ï¼Œæ¥ä¸‹æ¥å°±åˆ›å»ºæ•°æ®åº“ï¼Œè¿æ¥æ•°æ®åº“äº†

```
/*åˆ›å»ºæ•°æ®åº“ è¿è¡Œ node note.js*/

var Sequelize = require('sequelize');
var path = require('path');

var sequelize = new Sequelize(undefined, undefined, undefined, {
    host: 'localhost',
    dialect: 'sqlite',
    // SQLite only
    storage: path.join(__dirname, '../database/database.sqlite')
});

/* æµ‹è¯•è¿æ¥æ˜¯å¦æˆåŠŸ
node note.js

sequelize.authenticate()
    .then(() => {
        console.log('Connection has been established successfully.');
    })
    .catch(err => {
        console.error('Unable to connect to the database:', err);
    });

*/


var Note = sequelize.define('note', {
    text: {
        type: Sequelize.STRING
    },
    userid: {
        type: Sequelize.INTEGER
    },
    username: {
        type: Sequelize.STRING
    }
});

Note.sync();

/*
åˆ é™¤è¡¨
Note.drop();
*/


/*
//åˆ›å»ºæ•°æ®åº“

Note.sync().then(function(){
     Note.create({text:"sdsdsdsd"});
}).then(function(){
    //æŸ¥è¯¢è¡¨
    Note.findAll({raw:true}).then(function(notes){
        console.log(notes);
    })
});
*/




module.exports = Note;
```

ç„¶åæ˜¯åœ¨routes é‡Œå¤„ç† ajax è¯·æ±‚ï¼Œå¤„ç†ç™»å½•ä¿¡æ¯ï¼Œè·å– idï¼Œç”¨æˆ·åç­‰ç­‰ï¼Œåˆ°è¿™å°±åŸºæœ¬å®Œæˆäº†

## æ€»ç»“
ç»è¿‡ä¸€æ˜ŸæœŸçš„å¼€å‘ï¼Œäº†è§£äº†å‰åç«¯è”è°ƒï¼Œæ¨¡å—åŒ–å¼€å‘æ–¹å¼ã€webpack åŠloaderå’Œæ’ä»¶çš„ä½¿ç”¨ã€npm çš„ä½¿ç”¨ï¼ŒExpressçš„ä½¿ç”¨ã€è·¯ç”±ã€ä¸­é—´ä»¶ã€sqlite3ã€nodejsï¼Œåœ¨å¼€å‘è¿‡ç¨‹ä¸­è¿˜æ˜¯æœ‰é‡åˆ°è®¸å¤šé—®é¢˜ï¼Œä¾‹å¦‚åœ¨è¿ç»­å£°æ˜å˜é‡çš„æ—¶å€™ï¼Œä¸å°å¿ƒæŠŠé€—å·å†™æˆäº†åˆ†å·ï¼Œå…¶ä»–å˜é‡å°±å˜æˆäº†å…¨å±€å˜é‡ï¼Œäºæ˜¯å°±å‡ºé”™äº†ï¼ŒæŸ¥äº†å¥½ä¹…ğŸ˜‚
![](https://ws1.sinaimg.cn/large/006tKfTcly1fji7u6i1v0j30jm06y0t6.jpg)
ä¸è¿‡åœ¨è¿™è¿‡ç¨‹ä¹‹ä¸­è¿˜æ˜¯å­¦åˆ°äº†è®¸å¤šï¼Œé‡è¦çš„æ˜¯è¿‡ç¨‹ï¼Œç»§ç»­å¾€å‰ç«¯çš„è·¯èµ°ä¸‹å»ğŸ˜„










